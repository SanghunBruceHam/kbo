<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KBO Food Chain Diagram</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        h1 {
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 10px;
        }

        #container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            padding: 30px;
            margin-top: 20px;
        }

        #chart {
            position: relative;
        }

        .node {
            cursor: pointer;
        }

        .node circle {
            stroke-width: 2px;
            transition: all 0.3s ease;
        }

        .node:hover circle {
            filter: brightness(1.2);
            stroke-width: 4px;
        }

        .node text {
            font-size: 12px;
            font-weight: bold;
            text-anchor: middle;
            fill: white;
            pointer-events: none;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .link {
            fill: none;
            stroke-opacity: 0.6;
            stroke-width: 2;
            marker-end: url(#arrowhead);
            transition: all 0.3s ease;
        }

        .link:hover {
            stroke-opacity: 1;
            stroke-width: 4;
        }

        .dominant {
            stroke: #2ecc71;
        }

        .weak {
            stroke: #e74c3c;
        }

        .neutral {
            stroke: #95a5a6;
        }

        .legend {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-line {
            width: 30px;
            height: 3px;
            display: inline-block;
        }

        .stats {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255,255,255,0.95);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            min-width: 200px;
        }

        .stats h3 {
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .stats-item {
            font-size: 12px;
            margin: 5px 0;
            display: flex;
            justify-content: space-between;
        }

        .tooltip {
            position: absolute;
            text-align: center;
            padding: 10px;
            font-size: 12px;
            background: rgba(0,0,0,0.8);
            color: white;
            border-radius: 8px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
        }
    </style>
</head>
<body>
    <h1>ğŸ† 2025 KBO Food Chain Diagram (ìˆœìœ„ìˆœ ë°°ì¹˜)</h1>
    <div id="container">
        <div id="chart"></div>
        <div class="stats" id="stats">
            <h3>íŒ€ í†µê³„</h3>
            <div id="team-stats"></div>
        </div>
    </div>

    <div class="legend">
        <div class="legend-item">
            <div class="legend-line" style="background: #e74c3c;"></div>
            <span>ì••ë„ì  ìš°ì„¸ (ìŠ¹ë¥  â‰¥ 70%)</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #f39c12;"></div>
            <span>ìš°ì„¸ (60% ~ 70%)</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #3498db;"></div>
            <span>ì•½ê°„ ìš°ì„¸ (50% ~ 60%)</span>
        </div>
        <div class="legend-item">
            <span style="color: #666;">â€» 50% ì´í•˜ëŠ” í‘œì‹œí•˜ì§€ ì•ŠìŒ (ì—´ì„¸ ê´€ê³„)</span>
        </div>
    </div>

    <div class="tooltip" id="tooltip"></div>

    <script>
        // ìƒëŒ€ì „ì  ë°ì´í„°
        const headToHead = {
            "LG": {"ë¡¯ë°": {"W": 9, "L": 4}, "í•œí™”": {"W": 7, "L": 5}, "NC": {"W": 8, "L": 6}, "KT": {"W": 8, "L": 5}, "KIA": {"W": 11, "L": 5}, "í‚¤ì›€": {"W": 9, "L": 7}, "ë‘ì‚°": {"W": 9, "L": 6}, "ì‚¼ì„±": {"W": 9, "L": 6}, "SSG": {"W": 10, "L": 6}},
            "ë¡¯ë°": {"LG": {"W": 4, "L": 9}, "SSG": {"W": 6, "L": 9}, "KT": {"W": 8, "L": 6}, "í•œí™”": {"W": 6, "L": 9}, "ë‘ì‚°": {"W": 7, "L": 7}, "KIA": {"W": 8, "L": 8}, "NC": {"W": 7, "L": 7}, "í‚¤ì›€": {"W": 11, "L": 4}, "ì‚¼ì„±": {"W": 7, "L": 5}},
            "KIA": {"NC": {"W": 6, "L": 6}, "í‚¤ì›€": {"W": 7, "L": 6}, "í•œí™”": {"W": 4, "L": 9}, "ì‚¼ì„±": {"W": 7, "L": 7}, "LG": {"W": 5, "L": 11}, "ë¡¯ë°": {"W": 8, "L": 8}, "SSG": {"W": 7, "L": 6}, "KT": {"W": 8, "L": 7}, "ë‘ì‚°": {"W": 9, "L": 6}},
            "NC": {"KIA": {"W": 6, "L": 6}, "ì‚¼ì„±": {"W": 7, "L": 8}, "LG": {"W": 6, "L": 8}, "SSG": {"W": 4, "L": 8}, "í‚¤ì›€": {"W": 9, "L": 6}, "KT": {"W": 8, "L": 6}, "ë¡¯ë°": {"W": 7, "L": 7}, "í•œí™”": {"W": 6, "L": 9}, "ë‘ì‚°": {"W": 8, "L": 5}},
            "SSG": {"ë‘ì‚°": {"W": 7, "L": 5}, "ë¡¯ë°": {"W": 9, "L": 6}, "í‚¤ì›€": {"W": 8, "L": 6}, "NC": {"W": 8, "L": 4}, "KT": {"W": 8, "L": 6}, "ì‚¼ì„±": {"W": 7, "L": 8}, "KIA": {"W": 6, "L": 7}, "í•œí™”": {"W": 7, "L": 8}, "LG": {"W": 6, "L": 10}},
            "ë‘ì‚°": {"SSG": {"W": 5, "L": 7}, "KT": {"W": 4, "L": 11}, "ì‚¼ì„±": {"W": 6, "L": 9}, "í‚¤ì›€": {"W": 9, "L": 4}, "ë¡¯ë°": {"W": 7, "L": 7}, "í•œí™”": {"W": 8, "L": 6}, "LG": {"W": 6, "L": 9}, "KIA": {"W": 6, "L": 9}, "NC": {"W": 5, "L": 8}},
            "KT": {"í•œí™”": {"W": 5, "L": 9}, "ë‘ì‚°": {"W": 11, "L": 4}, "ë¡¯ë°": {"W": 6, "L": 8}, "LG": {"W": 5, "L": 8}, "SSG": {"W": 6, "L": 8}, "NC": {"W": 6, "L": 8}, "ì‚¼ì„±": {"W": 10, "L": 5}, "KIA": {"W": 7, "L": 8}, "í‚¤ì›€": {"W": 10, "L": 5}},
            "í•œí™”": {"KT": {"W": 9, "L": 5}, "LG": {"W": 5, "L": 7}, "KIA": {"W": 9, "L": 4}, "ë¡¯ë°": {"W": 9, "L": 6}, "ì‚¼ì„±": {"W": 8, "L": 8}, "ë‘ì‚°": {"W": 6, "L": 8}, "í‚¤ì›€": {"W": 13, "L": 2}, "SSG": {"W": 8, "L": 7}, "NC": {"W": 9, "L": 6}},
            "ì‚¼ì„±": {"í‚¤ì›€": {"W": 10, "L": 4}, "NC": {"W": 8, "L": 7}, "ë‘ì‚°": {"W": 9, "L": 6}, "KIA": {"W": 7, "L": 7}, "í•œí™”": {"W": 8, "L": 8}, "SSG": {"W": 8, "L": 7}, "KT": {"W": 5, "L": 10}, "LG": {"W": 6, "L": 9}, "ë¡¯ë°": {"W": 5, "L": 7}},
            "í‚¤ì›€": {"ì‚¼ì„±": {"W": 4, "L": 10}, "KIA": {"W": 6, "L": 7}, "SSG": {"W": 6, "L": 8}, "ë‘ì‚°": {"W": 4, "L": 9}, "NC": {"W": 6, "L": 9}, "LG": {"W": 7, "L": 9}, "í•œí™”": {"W": 2, "L": 13}, "ë¡¯ë°": {"W": 4, "L": 11}, "KT": {"W": 5, "L": 10}}
        };

        // íŒ€ ìƒ‰ìƒ
        const teamColors = {
            "LG": "#C30452",
            "KIA": "#EA002C",
            "ì‚¼ì„±": "#074CA1",
            "ë‘ì‚°": "#131230",
            "ë¡¯ë°": "#002955",
            "í•œí™”": "#FF6600",
            "SSG": "#CE0E2D",
            "NC": "#315288",
            "KT": "#000000",
            "í‚¤ì›€": "#570514"
        };

        // ê° íŒ€ì˜ ì˜í–¥ë ¥ ê³„ì‚° (ì´ ìŠ¹ìˆ˜ ê¸°ì¤€)
        function calculateInfluence(team) {
            let totalWins = 0;
            let totalLosses = 0;

            if (headToHead[team]) {
                Object.values(headToHead[team]).forEach(record => {
                    totalWins += record.W;
                    totalLosses += record.L;
                });
            }

            return {
                wins: totalWins,
                losses: totalLosses,
                winRate: totalWins / (totalWins + totalLosses),
                influence: totalWins // ì˜í–¥ë ¥ì€ ìŠ¹ìˆ˜ë¡œ
            };
        }

        // íŒ€ ìˆœìœ„ ì •ì˜ (2025 ì‹œì¦Œ ê¸°ì¤€)
        const teamRankings = ["LG", "í•œí™”", "SSG", "ì‚¼ì„±", "KT", "ë¡¯ë°", "NC", "KIA", "ë‘ì‚°", "í‚¤ì›€"];

        // ë…¸ë“œ ë°ì´í„° ìƒì„± (ìˆœìœ„ëŒ€ë¡œ)
        const nodes = teamRankings.map(team => ({
            id: team,
            ...calculateInfluence(team)
        }));

        // ë§í¬ ë°ì´í„° ìƒì„± (50% ì´ìƒ ìŠ¹ë¥ ë§Œ í‘œì‹œ - ìš°ì„¸í•œ ë°©í–¥ë§Œ)
        const links = [];
        teamRankings.forEach(team1 => {
            teamRankings.forEach(team2 => {
                if (team1 !== team2 && headToHead[team1] && headToHead[team1][team2]) {
                    const record = headToHead[team1][team2];
                    const winRate = record.W / (record.W + record.L);

                    // 50% ì´ˆê³¼ ìŠ¹ë¥ ì¸ ê²½ìš°ë§Œ í™”ì‚´í‘œ í‘œì‹œ (ë™ë¥ ì€ ì œì™¸)
                    if (winRate > 0.5) {
                        let type = 'neutral';
                        if (winRate >= 0.7) type = 'dominant';
                        else if (winRate >= 0.6) type = 'strong';

                        links.push({
                            source: team1,
                            target: team2,
                            wins: record.W,
                            losses: record.L,
                            winRate: winRate,
                            type: type
                        });
                    }
                }
            });
        });

        // SVG ì„¤ì •
        const width = 800;
        const height = 600;
        const radius = Math.min(width, height) / 3;

        const svg = d3.select("#chart")
            .append("svg")
            .attr("width", width)
            .attr("height", height);

        // í™”ì‚´í‘œ ë§ˆì»¤ ì •ì˜
        svg.append("defs")
            .append("marker")
            .attr("id", "arrowhead")
            .attr("viewBox", "0 -5 10 10")
            .attr("refX", 20)
            .attr("refY", 0)
            .attr("markerWidth", 8)
            .attr("markerHeight", 8)
            .attr("orient", "auto")
            .append("path")
            .attr("d", "M0,-5L10,0L0,5")
            .attr("fill", "#999");

        const g = svg.append("g")
            .attr("transform", `translate(${width/2},${height/2})`);

        // ì›í˜• ë ˆì´ì•„ì›ƒìœ¼ë¡œ ë…¸ë“œ ë°°ì¹˜ (12ì‹œ ë°©í–¥ë¶€í„° ì‹œê³„ë°©í–¥ìœ¼ë¡œ ìˆœìœ„ìˆœ)
        const angleStep = (2 * Math.PI) / nodes.length;
        nodes.forEach((node, i) => {
            const angle = i * angleStep - Math.PI / 2; // 12ì‹œ ë°©í–¥ë¶€í„° ì‹œì‘
            node.x = Math.cos(angle) * radius;
            node.y = Math.sin(angle) * radius;
            node.rank = i + 1; // ìˆœìœ„ ì¶”ê°€
        });

        // ê³¡ì„  ê²½ë¡œ ìƒì„± í•¨ìˆ˜
        function createCurvedPath(d) {
            const source = nodes.find(n => n.id === d.source);
            const target = nodes.find(n => n.id === d.target);

            const dx = target.x - source.x;
            const dy = target.y - source.y;
            const dr = Math.sqrt(dx * dx + dy * dy);

            return `M${source.x},${source.y}A${dr},${dr} 0 0,1 ${target.x},${target.y}`;
        }

        // ë§í¬ ê·¸ë¦¬ê¸°
        const link = g.selectAll(".link")
            .data(links)
            .enter().append("path")
            .attr("class", d => `link ${d.type}`)
            .attr("d", createCurvedPath)
            .style("stroke", d => {
                if (d.winRate >= 0.7) return "#e74c3c";  // 70% ì´ìƒ: ë¹¨ê°• (ë§¤ìš° ìš°ì„¸)
                else if (d.winRate >= 0.6) return "#f39c12"; // 60-70%: ì£¼í™© (ìš°ì„¸)
                else return "#3498db"; // 50-60%: íŒŒë‘ (ì•½ê°„ ìš°ì„¸)
            })
            .style("stroke-width", d => Math.max(1.5, d.wins / 4))
            .style("stroke-opacity", d => 0.3 + (d.winRate - 0.5) * 2) // ìŠ¹ë¥ ì— ë”°ë¼ íˆ¬ëª…ë„ ì¡°ì •
            .on("mouseover", function(event, d) {
                const source = nodes.find(n => n.id === d.source);
                const tooltip = d3.select("#tooltip");
                tooltip.transition().duration(200).style("opacity", 1);
                tooltip.html(`${d.source} â†’ ${d.target}<br/>ì „ì : ${d.wins}ìŠ¹ ${d.losses}íŒ¨<br/>ìŠ¹ë¥ : ${(d.winRate * 100).toFixed(1)}%`)
                    .style("left", (event.pageX + 10) + "px")
                    .style("top", (event.pageY - 28) + "px");
            })
            .on("mouseout", function() {
                d3.select("#tooltip").transition().duration(500).style("opacity", 0);
            });

        // ë…¸ë“œ í¬ê¸° ìŠ¤ì¼€ì¼
        const sizeScale = d3.scaleLinear()
            .domain(d3.extent(nodes, d => d.influence))
            .range([20, 50]);

        // ë…¸ë“œ ê·¸ë¦¬ê¸°
        const node = g.selectAll(".node")
            .data(nodes)
            .enter().append("g")
            .attr("class", "node")
            .attr("transform", d => `translate(${d.x},${d.y})`)
            .on("click", function(event, d) {
                updateStats(d);
            });

        node.append("circle")
            .attr("r", d => sizeScale(d.influence))
            .style("fill", d => teamColors[d.id])
            .style("stroke", "#fff");

        node.append("text")
            .text(d => `${d.rank}. ${d.id}`)
            .attr("dy", ".35em")
            .style("font-size", d => `${Math.max(10, sizeScale(d.influence) / 3)}px`);

        // í†µê³„ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateStats(teamData) {
            const statsDiv = d3.select("#team-stats");
            statsDiv.html("");

            statsDiv.append("div")
                .attr("class", "stats-item")
                .html(`<strong>${teamData.rank}ìœ„ ${teamData.id}</strong>`);

            statsDiv.append("div")
                .attr("class", "stats-item")
                .html(`<span>ì´ ìŠ¹ìˆ˜:</span> <span>${teamData.wins}ìŠ¹</span>`);

            statsDiv.append("div")
                .attr("class", "stats-item")
                .html(`<span>ì´ íŒ¨ìˆ˜:</span> <span>${teamData.losses}íŒ¨</span>`);

            statsDiv.append("div")
                .attr("class", "stats-item")
                .html(`<span>ìŠ¹ë¥ :</span> <span>${(teamData.winRate * 100).toFixed(1)}%</span>`);

            // ìƒëŒ€ì „ì  ë””í…Œì¼
            if (headToHead[teamData.id]) {
                statsDiv.append("div")
                    .style("margin-top", "10px")
                    .style("font-weight", "bold")
                    .text("ìƒëŒ€ ì „ì :");

                Object.entries(headToHead[teamData.id]).forEach(([opponent, record]) => {
                    const winRate = record.W / (record.W + record.L);
                    statsDiv.append("div")
                        .attr("class", "stats-item")
                        .style("font-size", "11px")
                        .style("color", winRate > 0.5 ? "#27ae60" : "#e74c3c")
                        .html(`<span>vs ${opponent}:</span> <span>${record.W}ìŠ¹ ${record.L}íŒ¨</span>`);
                });
            }
        }

        // ì´ˆê¸° í†µê³„ í‘œì‹œ (LG)
        updateStats(nodes.find(n => n.id === "LG"));

        // ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
        node.transition()
            .duration(1000)
            .attr("transform", d => `translate(${d.x},${d.y})`)
            .style("opacity", 1);

        link.transition()
            .duration(1500)
            .style("opacity", 1);
    </script>
</body>
</html>